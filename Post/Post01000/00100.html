<!DOCTYPE html>
<html>
  
<head>
    <meta charset="UTF-8">
    <style>
        #MRprimeButton
        {
            width: 50%;
            margin: 7px;
            color: #3A83BB;
            padding: 5px;
            border-style: solid;
            border-width: 2px;
            border-color: #3A83BB;
            border-radius: 5px;
            background-color: rgba(0, 0, 0, 0);
        }
        
        #isPrime
        {
            height: 30px;
            width: 50%;
            margin: 7px;
            padding: 5px;
            border-style: solid;
            border-width: 2px;
            border-color: #3A83BB;
            border-radius: 5px;
            background-color: rgba(0, 0, 0, 0);
        }
    </style>
    <title> 정수론 계산기 </title>
    <link rel="stylesheet" href="/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google tag (gtag.js) -->
    <script type="text/javascript" src="/googleAnalytics.js"></script>
</head>

<body>
    <div id = "wrap">  
    <div class = "container">
        <header>
            <script type="text/javascript" src="/headerWrite.js"></script>
        </header>
    </div>
    <section>
    
    <div id = "postTitle"> 정수론 계산기 </div>
    
    <hr>
      
    <p>
      
    <div>
        <ul><li>
                <a href="/Post/Post01000/00101.html"> 정수론 계산기 사용설명서 </a>
            </li>
            <li>
                <label for = "isPrime">계산할 수 :</label> 
                <input id = "isPrime" type = "text">
            </li>
            <li>
                <button id = "MRprimeButton" onclick = "showMRPrime()">밀러 - 라빈 소수 판별법 쓰기</button>
            </li>
        </ul>
    <div id="showResult"></div>
    <div id="showDiv"></div>
    <div id="showTime"></div>
	</div>

    <script>
        let mPL = [2n, 3n, 5n, 7n, 11n, 13n, 17n, 19n, 23n, 29n, 31n, 37n, 41n];

        function showMRPrime()
        {	
            var t0 = performance.now(); // 시작할 시간
            var N = BigInt(document.querySelector('#isPrime').value);  // 판별할 수
            
            if (N < 2n)
            {
                document.querySelector('#showResult').innerHTML = N + "보다 큰 자연수를 입력해주세요.";
                throw "stop";
            }
            
			if (isMRPrimeNumber(N) === false) { document.querySelector('#showResult').innerHTML = N + "은 합성수 입니다."; }
            else { document.querySelector('#showResult').innerHTML = N + "은 소수 입니다."; }

            var t1 = performance.now();
            var t2 = (t1 - t0) / 1000;
            document.querySelector('#showTime').innerHTML = t2.toFixed(5) + "초 걸림";
        }
        function isMRPrimeNumber(N)
        {
            for (let i = 0; i < mPL.length; i += 1) { if (N === mPL[i]) { return true } }
            if ( N < 4n ) { return true }
            if ( pow(2n, N - 1n, N) !== 1n ) {return false}

            let s = 0n;
            let d = N - 1n;
            while(d % 2n === 0n) { s += 1n; d = d / 2n; }
            if (d < 2n ** s) { return pow(3n, (N - 1n) / 2n, N) === N - 1n }

            if (N < 3317044064679887385961981n) {
                for (let i = 0; i < mPL.length; i += 1) { if ( MRTest(mPL[i], s, d, N) === false ) { return false } }
                return true
            }

            if ( MRTest(2n, s, d, N) === false ) { return false }

            let k = BigInt(String(N).length) * 3n;
            let pk = 2n ** k;
            while (pk < N) { pk = pk * 2n; k += 1n; }

            let Sln2N = k * k * 123n / 128n + 1n;
            for (let i = 3n; i <= Sln2N; i += 2n)
            {
                if (isPrimeI(i) ) {
                    if ( MRTest(i, s, d, N) === false ) { document.querySelector('#showDiv').innerText = "소수 아님"; return false; }
                    console.log(i);
                }
                inText(i, Sln2N);
                
            }
            return true
        }
        function isPrimeI(N)
        {
            for (let i = 0; i < mPL.length; i += 1) { if (N === mPL[i]) { return true } }
            if ( N < 4n ) { return true }
            if ( pow(2n, N - 1n, N) !== 1n ) {return false}

            let s = 0n;
            let d = N - 1n;
            while(d % 2n === 0n) { s += 1n; d = d / 2n; }
            if (d < 2n ** s) { return pow(3n, (N - 1n) / 2n, N) === N - 1n }

            if (N < 3317044064679887385961981n) {
                for (let i = 0; i < mPL.length; i += 1) { if ( MRTest(mPL[i], s, d, N) === false ) { return false } }
                return true
            }

            if ( MRTest(2n, s, d, N) === false ) { return false }

            let k = BigInt(String(N).length) * 3n;
            let pk = 2n ** k;
            while (pk < N) { pk = pk * 2n; k += 1n; }

            let Sln2N = k * k * 123n / 128n + 1n;
            for (let i = 3n; i <= Sln2N; i += 2n) { if ( MRTest(i, s, d, N) === false ) { return false; } }
            return true
        }
        function MRTest(a, s, d, N){
            let b = pow(a, d, N)
            if (b === 1n || b === N - 1n) {return true}
            for (let i = 0n; i < s - 1n; i += 1n)
            {
                b = pow(b, 2n, N);
                if (b === N - 1n) {return true}
            }
            return false
        }
        function pow(b, e, m) {
            if (e === 0n) {return 1n}
            if (e % 2n === 0n) {
                let byTwo = pow(b, e / 2n, m);
                return (byTwo * byTwo) % m
            }
            else {
                let byTwoPlusOne = pow(b, (e - 1n)/2n, m);
                return (b * ((byTwoPlusOne * byTwoPlusOne) % m)) % m
            }
        }
        function wait(msec)
        {
            let start = Date.now();
            now = start;
            while (now - start < msec) { now = Date.now(); }
        }
        function inText(i, Sln2N) {
            document.querySelector('#showDiv').innerText = String(i) + " / " + String(Sln2N) + "소수로 추정중";
        }
         
	</script>
      
    <br>
      
    </p>
      
    </section>
    <aside>
        <script type="text/javascript" src="/asideWrite.js"></script>
    </aside>
    
    <footer>
        <script type="text/javascript" src="/footerWrite.js"></script>
    </footer>
      
    </div> <!-- wrap -->
    
    <script type="text/javascript" src="/LaTexWrite.js"></script>

</body>
</html>
